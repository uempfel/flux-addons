stage: dev

addon_config:
  enable_ingress_nginx: true
  enable_cert_manager: true
  enable_kube_prometheus_stack: true
  enable_loki: true

cluster:
  name: addon-user-a
  node_image: kindest/node:v1.31.0
  wait_for_ready: true

  kind_config:
    kind: Cluster
    apiVersion: kind.x-k8s.io/v1alpha4
    kubeadmConfigPatches:
    - |-
      kind: ClusterConfiguration
      # configure controller-manager bind address
      controllerManager:
        extraArgs:
          bind-address: 0.0.0.0
      # configure etcd metrics listen address
      etcd:
        local:
          extraArgs:
            listen-metrics-urls: http://0.0.0.0:2381
      # configure scheduler bind address
      scheduler:
        extraArgs:
          bind-address: 0.0.0.0
    - |-
      kind: KubeProxyConfiguration
      # configure proxy metrics bind address
      metricsBindAddress: 0.0.0.0
    nodes:
    - role: control-plane
      kubeadmConfigPatches:
      - |
        kind: InitConfiguration
        nodeRegistration:
          kubeletExtraArgs:
            node-labels: "ingress-ready=true"
      extraPortMappings:
      - containerPort: 80
        hostPort: 80
        protocol: TCP
      - containerPort: 443
        hostPort: 443
        protocol: TCP
    # networking:
    #  disableDefaultCNI: true